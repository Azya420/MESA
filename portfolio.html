<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MESA — Portfolio</title>
  <meta name="description" content="Portfolio MESA — książka 2‑stronicowa (flipbook)." />
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="page-portfolio">
<header class="topbar">
  <div class="wrap topbar-inner">
    <a class="brandlink" href="index.html">
      <div class="brand">
        <img class="logo-img" src="assets/logo.png" alt="MESA logo" />
        <div class="tag">Architektura × Wydruk 3D</div>
      </div>
    </a>
    <nav class="nav">
      <a href="index.html">Strona główna</a>
      <a href="portfolio.html" aria-current="page">Portfolio</a>
      <a href="o-nas.html">O nas</a>
      <a href="kontakt.html">Kontakt</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <section class="section">
    <div class="book2-wrap">
      <div class="book2-stage">
        <div id="book2" class="book2" tabindex="0" aria-label="Portfolio flipbook (2 strony)"></div>
        <div class="book2-nav" aria-hidden="true">
          <button class="book2-nav-btn prev" id="book2-prev" type="button" aria-label="Poprzednia strona">
            <span aria-hidden="true">‹</span>
          </button>
          <button class="book2-nav-btn next" id="book2-next" type="button" aria-label="Następna strona">
            <span aria-hidden="true">›</span>
          </button>
        </div>
        <div class="portfolio-download">
          <a class="btn primary" href="assets/PORTFOLIO MESA - mesa3d.pl.pdf" download>
            Pobierz portfolio (PDF)
          </a>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  const spreads = [
    ["assets/mesa_na_strone_05.webp", "assets/mesa_na_strone_06.webp"],
    ["assets/mesa_na_strone_07.webp", "assets/mesa_na_strone_08.webp"],
    ["assets/mesa_na_strone_09.webp", "assets/mesa_na_strone_10.webp"],
    ["assets/mesa_na_strone_11.webp", "assets/mesa_na_strone_12.webp"],
    ["assets/mesa_na_strone_13.webp", "assets/mesa_na_strone_14.webp"],
    ["assets/mesa_na_strone_15.webp", "assets/mesa_na_strone_16.webp"]
  ]; // [ [left,right], ... ]
  const pageOffset = 5;
  const total = spreads.length;

  const book = document.getElementById('book2');
  const prevBtn = document.getElementById('book2-prev');
  const nextBtn = document.getElementById('book2-next');

  let current = 0; // spread index
  let animating = false;

  function el(tag, cls){
    const n = document.createElement(tag);
    if (cls) n.className = cls;
    return n;
  }

  function img(src, alt, opts = {}){
    const i = document.createElement('img');
    i.className = 'pageimg';
    i.src = src;
    i.alt = alt;
    i.loading = opts.loading || 'lazy';
    return i;
  }

  function renderSpread(idx, opts = {}){
    const keepExisting = opts.keepExisting === true;
    if (!keepExisting) book.innerHTML = "";
    const spread = el("div","spread" + (opts.entering ? " is-entering" : ""));
    const loading = opts.loading || "eager";

    const leftPane = el("div","pagepane");
    const leftNum = pageOffset + idx * 2;
    leftPane.appendChild(img(spreads[idx][0], "Strona " + leftNum, { loading }));
    const ln = el("div","pagenum"); ln.textContent = String(leftNum);
    leftPane.appendChild(ln);

    const rightPane = el("div","pagepane");
    const rightNum = pageOffset + idx * 2 + 1;
    rightPane.appendChild(img(spreads[idx][1], "Strona " + rightNum, { loading }));
    const rn = el("div","pagenum"); rn.textContent = String(rightNum);
    rightPane.appendChild(rn);

    spread.appendChild(leftPane);
    spread.appendChild(rightPane);
    book.appendChild(spread);
    if (opts.entering) {
      requestAnimationFrame(function(){
        spread.classList.remove("is-entering");
      });
    }
    updateNav();

  }

  function updateNav(){
    if (!prevBtn || !nextBtn) return;
    prevBtn.disabled = current <= 0 || animating;
    nextBtn.disabled = current >= total - 1 || animating;
  }

  function animateTurn(direction){
    if (animating) return;
    if (direction === "next" && current >= total - 1) return;
    if (direction === "prev" && current <= 0) return;

    animating = true;
    updateNav();
    book.classList.add("is-animating");
    const layer = el("div","turnlayer");
    const turnPage = el("div","turnpage " + (direction === "next" ? "right" : "left"));
    const faceFront = el("div","face front");
    const faceBack = el("div","face back");

    const curL = spreads[current][0];
    const curR = spreads[current][1];

    const target = (direction === "next") ? current + 1 : current - 1;
    const nextL = spreads[target][0];
    const nextR = spreads[target][1];

    if (direction === "next"){
      const curRightNum = pageOffset + current * 2 + 1;
      const nextLeftNum = pageOffset + target * 2;
      faceFront.appendChild(img(curR, "Strona " + curRightNum, { loading: "eager" }));
      faceBack.appendChild(img(nextL, "Strona " + nextLeftNum, { loading: "eager" }));
    } else {
      const curLeftNum = pageOffset + current * 2;
      const nextRightNum = pageOffset + target * 2 + 1;
      faceFront.appendChild(img(curL, "Strona " + curLeftNum, { loading: "eager" }));
      faceBack.appendChild(img(nextR, "Strona " + nextRightNum, { loading: "eager" }));
    }

    const shade = el("div","shade");
    turnPage.appendChild(faceFront);
    turnPage.appendChild(faceBack);
    turnPage.appendChild(shade);
    layer.appendChild(turnPage);
    book.appendChild(layer);

    renderSpread(target, { entering: true, keepExisting: true, loading: "eager" });

    requestAnimationFrame(function(){
      const rot = (direction === "next") ? -180 : 180;
      turnPage.style.transition = "transform .85s cubic-bezier(.2,.75,.2,1)";
      turnPage.style.transform = "rotateY(" + rot + "deg)";
    });

    turnPage.addEventListener("transitionend", function(){
      const spread = book.querySelector(".spread");
      if (spread) spread.remove();
      layer.remove();
      current = target;
      animating = false;
      book.classList.remove("is-animating");
      updateNav();
      setTimeout(function(){ book.focus(); }, 50);
    }, { once: true });
  }

  function goNext(){ animateTurn("next"); }
  function goPrev(){ animateTurn("prev"); }

  // Click zones: right half next, left half prev
  book.addEventListener("click", function(e){
    const rect = book.getBoundingClientRect();
    const x = e.clientX - rect.left;
    if (x > rect.width * 0.55) goNext();
    else goPrev();
  });

  book.addEventListener("keydown", function(e){
    if (e.key === "ArrowRight") { e.preventDefault(); goNext(); }
    if (e.key === "ArrowLeft") { e.preventDefault(); goPrev(); }
  });

  prevBtn.addEventListener("click", function(e){
    e.stopPropagation();
    goPrev();
  });

  nextBtn.addEventListener("click", function(e){
    e.stopPropagation();
    goNext();
  });

  // Touch swipe
  let touchStartX = null;
  book.addEventListener("touchstart", function(e){ touchStartX = e.touches[0].clientX; }, {passive:true});
  book.addEventListener("touchend", function(e){
    if (touchStartX === null) return;
    const dx = e.changedTouches[0].clientX - touchStartX;
    if (Math.abs(dx) > 40) {
      if (dx < 0) goNext();
      else goPrev();
    }
    touchStartX = null;
  }, {passive:true});

  renderSpread(current);
  setTimeout(function(){ book.focus(); }, 200);
</script>

<footer class="site-footer">
  <div class="wrap site-footer-inner">
    <div class="footer-brand">
      <span class="footer-title">MESA</span>
      <span class="footer-subtitle">Architektura × Wydruk 3D</span>
    </div>
    <div class="footer-links">
      <a href="o-nas.html">O nas</a>
      <a href="portfolio.html">Portfolio</a>
      <a href="kontakt.html">Kontakt</a>
    </div>
    <div class="footer-contact">
      <a href="mailto:mesa.kontakt@gmail.com">mesa.kontakt@gmail.com</a>
      <a href="tel:+48517703888">+48 517 703 888</a>
    </div>
  </div>
</footer>
</body>
</html>
