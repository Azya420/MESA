<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MESA — Portfolio</title>
  <meta name="description" content="Portfolio MESA — książka 2‑stronicowa (flipbook)." />
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="page-portfolio">
<header class="topbar">
  <div class="wrap topbar-inner">
    <a class="brandlink" href="index.html">
      <div class="brand">
        <img class="logo-img" src="assets/logo.png" alt="MESA logo" />
        <div class="tag">Architektura × Wydruk 3D</div>
      </div>
    </a>
    <nav class="nav">
      <a href="index.html">Strona główna</a>
      <a href="portfolio.html" aria-current="page">Portfolio</a>
      <a href="o-nas.html">O nas</a>
      <a href="kontakt.html">Kontakt</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <section class="section">
    <div class="book2-wrap">
      <div class="book2-stage">
        <button class="book2-arrow book2-arrow-prev" type="button" aria-label="Poprzednia strona">
          <span aria-hidden="true">&#10094;</span>
        </button>
        <div id="book2" class="book2" tabindex="0" aria-label="Portfolio flipbook (2 strony)"></div>
        <button class="book2-arrow book2-arrow-next" type="button" aria-label="Następna strona">
          <span aria-hidden="true">&#10095;</span>
        </button>
      </div>
    </div>
  </div>
</main>

<script>
  if ('scrollRestoration' in history) {
    history.scrollRestoration = 'manual';
  }
  function scrollToTop(){
    window.scrollTo({ top: 0, left: 0, behavior: 'auto' });
  }
  window.addEventListener('DOMContentLoaded', scrollToTop);
  window.addEventListener('load', function(){
    scrollToTop();
    setTimeout(scrollToTop, 100);
  });
  const spreads = [
  ["assets/pages/page-05.webp", "assets/pages/page-06.webp"],
  ["assets/pages/page-07.webp", "assets/pages/page-08.webp"],
  ["assets/pages/page-09.webp", "assets/pages/page-10.webp"],
  ["assets/pages/page-11.webp", "assets/pages/page-12.webp"],
  ["assets/pages/page-13.webp", "assets/pages/page-14.webp"],
  ["assets/pages/page-15.webp", "assets/pages/page-16.webp"]
]; // [ [left,right], ... ]
  const total = spreads.length;

  const book = document.getElementById('book2');
  const prevBtn = document.querySelector('.book2-arrow-prev');
  const nextBtn = document.querySelector('.book2-arrow-next');

  let current = 0; // spread index
  let animating = false;

  function el(tag, cls){
    const n = document.createElement(tag);
    if (cls) n.className = cls;
    return n;
  }

  function img(src, alt){
    const i = document.createElement('img');
    i.className = 'pageimg';
    i.src = src;
    i.alt = alt;
    i.loading = 'lazy';
    return i;
  }

  function renderSpread(idx){
    book.innerHTML = "";
    const spread = el("div","spread");

    const leftPane = el("div","pagepane");
    leftPane.appendChild(img(spreads[idx][0], "Strona " + (idx*2+1)));
    const ln = el("div","pagenum"); ln.textContent = String(idx*2+1);
    leftPane.appendChild(ln);

    const rightPane = el("div","pagepane");
    rightPane.appendChild(img(spreads[idx][1], "Strona " + (idx*2+2)));
    const rn = el("div","pagenum"); rn.textContent = String(idx*2+2);
    rightPane.appendChild(rn);

    spread.appendChild(leftPane);
    spread.appendChild(rightPane);
    book.appendChild(spread);
    updateButtons();

  }

  function updateButtons(){
    if (prevBtn) prevBtn.disabled = current <= 0;
    if (nextBtn) nextBtn.disabled = current >= total - 1;
  }

  function animateTurn(direction){
    if (animating) return;
    if (direction === "next" && current >= total - 1) return;
    if (direction === "prev" && current <= 0) return;

    animating = true;
    book.classList.add("is-animating");
    const layer = el("div","turnlayer");
    const turnPage = el("div","turnpage " + (direction === "next" ? "right" : "left"));
    const faceFront = el("div","face front");
    const faceBack = el("div","face back");

    const curL = spreads[current][0];
    const curR = spreads[current][1];

    const target = (direction === "next") ? current + 1 : current - 1;
    const nextL = spreads[target][0];
    const nextR = spreads[target][1];

    if (direction === "next"){
      faceFront.appendChild(img(curR, "Strona " + (current*2+2)));
      faceBack.appendChild(img(nextL, "Strona " + (target*2+1)));
    } else {
      faceFront.appendChild(img(curL, "Strona " + (current*2+1)));
      faceBack.appendChild(img(nextR, "Strona " + (target*2+2)));
    }

    const shade = el("div","shade");
    turnPage.appendChild(faceFront);
    turnPage.appendChild(faceBack);
    turnPage.appendChild(shade);
    layer.appendChild(turnPage);
    book.appendChild(layer);

    requestAnimationFrame(function(){
      const rot = (direction === "next") ? -180 : 180;
      turnPage.style.transition = "transform .85s cubic-bezier(.2,.75,.2,1)";
      turnPage.style.transform = "rotateY(" + rot + "deg)";
    });

    turnPage.addEventListener("transitionend", function(){
      current = target;
      animating = false;
      book.classList.remove("is-animating");
      renderSpread(current);
      setTimeout(function(){ book.focus(); }, 50);
    }, { once: true });
  }

  function goNext(){ animateTurn("next"); }
  function goPrev(){ animateTurn("prev"); }

  if (prevBtn) prevBtn.addEventListener("click", goPrev);
  if (nextBtn) nextBtn.addEventListener("click", goNext);

  // Click zones: right half next, left half prev
  book.addEventListener("click", function(e){
    const rect = book.getBoundingClientRect();
    const x = e.clientX - rect.left;
    if (x > rect.width * 0.55) goNext();
    else goPrev();
  });

  book.addEventListener("keydown", function(e){
    if (e.key === "ArrowRight") { e.preventDefault(); goNext(); }
    if (e.key === "ArrowLeft") { e.preventDefault(); goPrev(); }
  });

  // Touch swipe
  let touchStartX = null;
  book.addEventListener("touchstart", function(e){ touchStartX = e.touches[0].clientX; }, {passive:true});
  book.addEventListener("touchend", function(e){
    if (touchStartX === null) return;
    const dx = e.changedTouches[0].clientX - touchStartX;
    if (Math.abs(dx) > 40) {
      if (dx < 0) goNext();
      else goPrev();
    }
    touchStartX = null;
  }, {passive:true});

  renderSpread(current);
  setTimeout(function(){ book.focus(); }, 200);
</script>
</body>
</html>
